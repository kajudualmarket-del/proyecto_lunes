<div class="upload-container">
  <div class="header-section">
    <h2>ğŸ“‚ Bienvenidos a mi trabajo de excel <span>ğŸ‘‹</span></h2>
    <p class="subtitle">Sube tu archivo Excel <b>(.xls o .xlsx)</b></p>
  </div>

  <div class="upload-box">
    <label class="file-label">
      <input type="file" (change)="onFileSelected($event)" hidden />
      <span class="file-button">Seleccionar archivo</span>
    </label>
    <button class="upload-btn" (click)="uploadFile()">ğŸš€ Subir archivo</button>
  </div>

  <div *ngIf="uploadProgress > 0" class="progress-bar">
    <div class="progress" [style.width.%]="uploadProgress">
      <span *ngIf="uploadProgress < 100">{{ uploadProgress }}%</span>
      <span *ngIf="uploadProgress === 100">âœ”ï¸</span>
    </div>
  </div>

  <p class="status-msg" [ngClass]="{ success: uploadProgress === 100, error: message.includes('Error') }">
    {{ message }}
  </p>

  <h3 class="section-title">ğŸ“ Archivos Subidos</h3>

  <div *ngIf="files.length === 0" class="no-files">
    <p>AÃºn no has subido ningÃºn archivo.</p>
  </div>

  <table *ngIf="files.length > 0" class="file-table">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>TamaÃ±o</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let file of files">
        <td>{{ file.filename }}</td>
        <td>{{ (file.filesize / 1024).toFixed(1) }} KB</td>
        <td class="actions">
          <button class="btn view" (click)="showPreview(file.id!)">ğŸ‘€ Ver</button>
          <button class="btn insert" (click)="insertData(file.id!)">
            <span class="btn-text">â¬†ï¸ Insertar</span>
            <span class="loading-spinner"></span>
          </button>
          <button class="btn delete" (click)="deleteFile(file.id!)">ğŸ—‘ï¸ Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ğŸ” PrevisualizaciÃ³n del contenido del Excel -->
  <div *ngIf="previewData && previewData.length > 0" class="preview-section">
    <h3>ğŸ“„ PrevisualizaciÃ³n</h3>

    <div *ngFor="let hoja of previewData" class="sheet-preview">
      <h4>{{ hoja.nombre }}</h4>
      <p class="mensaje" [ngClass]="{ success: hoja.mensaje.includes('vÃ¡lida'), warning: !hoja.mensaje.includes('vÃ¡lida') }">
        {{ hoja.mensaje }}
      </p>

      <p *ngIf="!hoja.datos || hoja.datos.length === 0" class="empty-sheet">
        âš ï¸ Esta hoja no tiene datos.
      </p>

      <table *ngIf="hoja.datos && hoja.datos.length > 0" class="data-table">
        <thead>
          <tr>
            <th *ngFor="let key of Object.keys(hoja.datos[0])">{{ key }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of hoja.datos">
            <td *ngFor="let key of Object.keys(row)">{{ row[key] }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

<!-- ğŸ“Š SecciÃ³n del grÃ¡fico (solo visible despuÃ©s de insertar datos) -->
<div *ngIf="chartData && chartData.length > 0" class="chart-section">
  <h3>ğŸ“Š EstadÃ­sticas de Productos</h3>
  <app-chart [chartDataInput]="chartData"></app-chart>
</div>


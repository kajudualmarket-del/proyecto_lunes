{"ast":null,"code":"import { HttpEventType } from '@angular/common/http';\nimport { CommonModule } from '@angular/common';\nimport { ChartComponent } from '../chart/chart.component'; // Importa el chart\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/excel.service\";\nimport * as i2 from \"@angular/common\";\nfunction UploadComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5);\n    i0.ɵɵelement(1, \"div\", 6);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵstyleProp(\"width\", ctx_r0.uploadProgress, \"%\");\n  }\n}\nfunction UploadComponent_table_13_tr_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"button\", 2);\n    i0.ɵɵlistener(\"click\", function UploadComponent_table_13_tr_8_Template_button_click_6_listener() {\n      const file_r3 = i0.ɵɵrestoreView(_r2).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.showPreview(file_r3.id));\n    });\n    i0.ɵɵtext(7, \"Ver\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 2);\n    i0.ɵɵlistener(\"click\", function UploadComponent_table_13_tr_8_Template_button_click_8_listener() {\n      const file_r3 = i0.ɵɵrestoreView(_r2).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.insertData(file_r3.id));\n    });\n    i0.ɵɵtext(9, \"Insertar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 2);\n    i0.ɵɵlistener(\"click\", function UploadComponent_table_13_tr_8_Template_button_click_10_listener() {\n      const file_r3 = i0.ɵɵrestoreView(_r2).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.deleteFile(file_r3.id));\n    });\n    i0.ɵɵtext(11, \"Eliminar\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r3.filename);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", (file_r3.filesize / 1024).toFixed(1), \" KB\");\n  }\n}\nfunction UploadComponent_table_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\")(1, \"tr\")(2, \"th\");\n    i0.ɵɵtext(3, \"Nombre\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"th\");\n    i0.ɵɵtext(5, \"Tama\\u00F1o\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Acciones\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(8, UploadComponent_table_13_tr_8_Template, 12, 2, \"tr\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.files);\n  }\n}\nfunction UploadComponent_div_14_div_3_p_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \" Esta hoja no tiene datos. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UploadComponent_div_14_div_3_table_4_th_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const key_r4 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(key_r4);\n  }\n}\nfunction UploadComponent_div_14_div_3_table_4_tr_3_td_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const key_r5 = ctx.$implicit;\n    const row_r6 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(row_r6[key_r5]);\n  }\n}\nfunction UploadComponent_div_14_div_3_table_4_tr_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵtemplate(1, UploadComponent_div_14_div_3_table_4_tr_3_td_1_Template, 2, 1, \"td\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const hoja_r7 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", hoja_r7.columnas);\n  }\n}\nfunction UploadComponent_div_14_div_3_table_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\")(1, \"tr\");\n    i0.ɵɵtemplate(2, UploadComponent_div_14_div_3_table_4_th_2_Template, 2, 1, \"th\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, UploadComponent_div_14_div_3_table_4_tr_3_Template, 2, 1, \"tr\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const hoja_r7 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", hoja_r7.columnas);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", hoja_r7.datos);\n  }\n}\nfunction UploadComponent_div_14_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h4\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, UploadComponent_div_14_div_3_p_3_Template, 2, 0, \"p\", 4)(4, UploadComponent_div_14_div_3_table_4_Template, 4, 2, \"table\", 4);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const hoja_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(hoja_r7.nombre);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !hoja_r7.datos || hoja_r7.datos.length === 0);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", hoja_r7.datos && hoja_r7.datos.length > 0);\n  }\n}\nfunction UploadComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h3\");\n    i0.ɵɵtext(2, \"Previsualizaci\\u00F3n\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, UploadComponent_div_14_div_3_Template, 5, 3, \"div\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.previewData.hojas);\n  }\n}\nfunction UploadComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h3\");\n    i0.ɵɵtext(2, \"Estad\\u00EDsticas de Productos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"app-chart\", 8);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"chartDataInput\", ctx_r0.chartData);\n  }\n}\nexport let UploadComponent = /*#__PURE__*/(() => {\n  class UploadComponent {\n    excelService;\n    selectedFile = null;\n    uploadProgress = 0;\n    message = '';\n    files = [];\n    previewData = null;\n    // NUEVO: datos para el gráfico\n    chartData = null;\n    constructor(excelService) {\n      this.excelService = excelService;\n    }\n    ngOnInit() {\n      this.loadFiles();\n      this.fetchChartData(); // NUEVO: carga inicial del gráfico\n    }\n    onFileSelected(event) {\n      const file = event.target.files[0];\n      if (file && (file.name.endsWith('.xls') || file.name.endsWith('.xlsx'))) {\n        this.selectedFile = file;\n      } else {\n        alert('Solo se permiten archivos .xls o .xlsx');\n      }\n    }\n    uploadFile() {\n      if (!this.selectedFile) {\n        alert('Seleccione un archivo primero');\n        return;\n      }\n      this.excelService.uploadExcel(this.selectedFile).subscribe({\n        next: event => {\n          if (event.type === HttpEventType.UploadProgress && event.total) {\n            this.uploadProgress = Math.round(100 * event.loaded / event.total);\n          } else if (event.type === HttpEventType.Response) {\n            this.message = 'Archivo subido correctamente';\n            this.uploadProgress = 100;\n            this.loadFiles();\n            // NUEVO: actualizar gráfico después de subir\n            this.fetchChartData();\n          }\n        },\n        error: () => {\n          this.message = 'Error al subir archivo';\n        }\n      });\n    }\n    loadFiles() {\n      this.excelService.getFiles().subscribe({\n        next: data => this.files = data,\n        error: () => alert('Error al cargar archivos')\n      });\n    }\n    showPreview(fileId) {\n      this.excelService.getExcelPreview(fileId).subscribe({\n        next: data => this.previewData = data,\n        error: () => alert('Error al obtener previsualización')\n      });\n    }\n    insertData(fileId) {\n      this.uploadProgress = 0;\n      const interval = setInterval(() => {\n        if (this.uploadProgress < 100) this.uploadProgress += 5;else clearInterval(interval);\n      }, 100);\n      this.excelService.insertExcelData(fileId).subscribe({\n        next: () => {\n          alert('Datos insertados correctamente');\n          this.uploadProgress = 100;\n          // NUEVO: actualizar gráfico después de insertar\n          this.fetchChartData();\n        },\n        error: () => alert('Error al insertar datos')\n      });\n    }\n    deleteFile(id) {\n      if (confirm('¿Desea eliminar este archivo?')) {\n        this.excelService.deleteFile(id).subscribe({\n          next: () => {\n            this.loadFiles();\n            // NUEVO: actualizar gráfico después de eliminar\n            this.fetchChartData();\n          },\n          error: () => alert('Error al eliminar archivo')\n        });\n      }\n    }\n    // NUEVO: método para obtener datos del gráfico\n    fetchChartData() {\n      this.excelService.getChartData().subscribe({\n        next: data => {\n          this.chartData = data;\n        },\n        error: () => console.error('Error al obtener datos del gráfico')\n      });\n    }\n    static ɵfac = function UploadComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || UploadComponent)(i0.ɵɵdirectiveInject(i1.ExcelService));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: UploadComponent,\n      selectors: [[\"app-upload\"]],\n      decls: 16,\n      vars: 5,\n      consts: [[1, \"upload-container\"], [\"type\", \"file\", 3, \"change\"], [3, \"click\"], [\"class\", \"progress-bar\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"progress-bar\"], [1, \"progress\"], [4, \"ngFor\", \"ngForOf\"], [3, \"chartDataInput\"]],\n      template: function UploadComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n          i0.ɵɵtext(2, \"Bienvenido \\uD83D\\uDC4B\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"p\");\n          i0.ɵɵtext(4, \"Sube tu archivo Excel (.xls o .xlsx)\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"input\", 1);\n          i0.ɵɵlistener(\"change\", function UploadComponent_Template_input_change_5_listener($event) {\n            return ctx.onFileSelected($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"button\", 2);\n          i0.ɵɵlistener(\"click\", function UploadComponent_Template_button_click_6_listener() {\n            return ctx.uploadFile();\n          });\n          i0.ɵɵtext(7, \"Subir archivo\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(8, UploadComponent_div_8_Template, 2, 2, \"div\", 3);\n          i0.ɵɵelementStart(9, \"p\");\n          i0.ɵɵtext(10);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(11, \"h3\");\n          i0.ɵɵtext(12, \"Archivos Subidos\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(13, UploadComponent_table_13_Template, 9, 1, \"table\", 4)(14, UploadComponent_div_14_Template, 4, 1, \"div\", 4)(15, UploadComponent_div_15_Template, 4, 1, \"div\", 4);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"ngIf\", ctx.uploadProgress > 0);\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate(ctx.message);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.files.length > 0);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.previewData);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.chartData);\n        }\n      },\n      dependencies: [CommonModule, i2.NgForOf, i2.NgIf, ChartComponent],\n      styles: [\".upload-container[_ngcontent-%COMP%]{width:80%;margin:0 auto;text-align:center}.upload-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2a3f54}.upload-container[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{margin:10px 0}.upload-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:5px;padding:8px 16px;background-color:#0078d7;color:#fff;border:none;border-radius:4px;cursor:pointer}.upload-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#005fa3}.upload-container[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{width:100%;height:10px;background:#e0e0e0;margin:10px 0;border-radius:5px}.upload-container[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{height:100%;background:linear-gradient(to right,#0078d7,#00c8ff);border-radius:5px;transition:width .3s}.upload-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px}.upload-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .upload-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:8px}.upload-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#0078d7;color:#fff}\"]\n    });\n  }\n  return UploadComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}